<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Edz√©s Jelentkez√©s</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f2f5;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 450px;
    }
    h2 {
      text-align: center;
      margin: 0 0 5px 0;
    }
    h4 {
      text-align: center;
      margin: 0 0 20px 0;
      font-size: 14px;
      color: #777;
    }
    input,
    select {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 16px;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 14px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover {
      background-color: #1f8a39;
    }
    #status {
      margin-top: 10px;
      font-weight: bold;
      min-height: 24px;
      text-align: center;
    }
    .attendee-list {
      margin-top: 25px;
      background: #fafafa;
      border-radius: 10px;
      border: 1px solid #eee;
      padding: 15px;
    }
    .attendee-list h3 {
      margin: 0 0 10px 0;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
    }
    .attendee-card {
      background: white;
      border-radius: 8px;
      padding: 8px 10px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid #eee;
      font-size: 14px;
    }
    .attendee-info {
      display: flex;
      flex-direction: column;
    }
    .attendee-name {
      font-weight: 600;
    }
    .attendee-date {
      font-size: 13px;
      color: #555;
    }
    .delete-btn {
      background: #dc3545;
      border: none;
      color: white;
      border-radius: 6px;
      padding: 4px 10px;
      cursor: pointer;
      font-size: 13px;
    }
    .delete-btn:hover {
      background: #b92432;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üèì Edz√©s Jelentkez√©s</h2>
    <h4>(Tagoknak NEM kell regisztr√°lni)</h4>

    <input type="text" id="nev" placeholder="√çrd be a neved..." />

    <select id="idopont">
      <option disabled selected value="">-- V√°lassz id≈ëpontot --</option>
    </select>

    <button onclick="submitForm()">OTT LESZEK!</button>
    <div id="status"></div>

    <div class="attendee-list">
      <h3>Jelentkez≈ëk list√°ja:</h3>
      <div id="attendeeCards"></div>
    </div>
  </div>

  <script>
    // IDE KELL BEM√ÅSOLNI A WEB APP URL-T (‚Ä¶/exec)
    const SCRIPT_URL = "IDE_√çRD_BE_A_SCRIPT_URL-T";

    let allDates = [];
    let allAttendees = [];

    function setStatus(msg, color) {
      const st = document.getElementById("status");
      st.textContent = msg || "";
      st.style.color = color || "#333";
    }

    function loadData() {
      setStatus("Adatok bet√∂lt√©se...", "#555");

      fetch(SCRIPT_URL)
        .then((res) => {
          if (!res.ok) throw new Error("HTTP " + res.status);
          return res.json();
        })
        .then((data) => {
          allDates = Array.isArray(data.dates) ? data.dates : [];
          allAttendees = Array.isArray(data.attendees) ? data.attendees : [];

          allDates = allDates.filter(
            (d) => typeof d === "string" && d.trim() !== ""
          );

          fillDateSelect();
          renderAttendees();
          setStatus("");
        })
        .catch((err) => {
          console.error("loadData error:", err);
          setStatus("Hiba a kapcsol√≥d√°skor!", "red");
        });
    }

    function fillDateSelect() {
      const sel = document.getElementById("idopont");
      sel.innerHTML =
        "<option disabled selected value=''>-- V√°lassz id≈ëpontot --</option>";

      allDates.forEach((d) => {
        const opt = document.createElement("option");
        opt.value = d;
        opt.textContent = d;
        sel.appendChild(opt);
      });
    }

    function renderAttendees() {
      const box = document.getElementById("attendeeCards");
      if (!allAttendees.length) {
        box.innerHTML = "<i>M√©g nincs jelentkez≈ë.</i>";
        return;
      }

      box.innerHTML = allAttendees
        .map((a, idx) => {
          const nev = a.nev || "";
          const ido = a.idopont || "";
          return `
          <div class="attendee-card">
            <div class="attendee-info">
              <span class="attendee-name">${nev}</span>
              <span class="attendee-date">${ido}</span>
            </div>
            <button class="delete-btn" onclick="deleteSelf(${idx})">T√∂rl√©s</button>
          </div>`;
        })
        .join("");
    }

    function submitForm() {
      const nev = document.getElementById("nev").value.trim();
      const date = document.getElementById("idopont").value;

      if (!nev || !date) {
        setStatus("T√∂ltsd ki mindk√©t mez≈ët!", "red");
        return;
      }

      // 5 f≈ës limit adott napra
      const count = allAttendees.filter((a) => a.idopont === date).length;
      if (count >= 5) {
        setStatus("Erre az edz√©sre betelt az 5 f≈ës limit!", "red");
        return;
      }

      setStatus("K√ºld√©s...", "blue");

      const body =
        "action=add" +
        "&nev=" +
        encodeURIComponent(nev) +
        "&idopont=" +
        encodeURIComponent(date);

      fetch(SCRIPT_URL, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: body,
      })
        .then(() => {
          setStatus("Sikeres jelentkez√©s! ‚úÖ", "green");
          document.getElementById("nev").value = "";
          setTimeout(loadData, 800);
        })
        .catch((err) => {
          console.error("submit error:", err);
          setStatus("Hiba t√∂rt√©nt a ment√©skor.", "red");
        });
    }

    function deleteSelf(index) {
      const nevInput = document.getElementById("nev").value.trim();
      const row = allAttendees[index];
      if (!row) return;

      if (!nevInput) {
        alert("√çrd be a saj√°t neved a t√∂rl√©shez!");
        return;
      }
      if (nevInput !== row.nev) {
        alert("Csak a SAJ√ÅT jelentkez√©sed t√∂r√∂lheted!");
        return;
      }

      if (
        !confirm(
          `Biztos t√∂rl√∂d a jelentkez√©sed?\n${row.nev} ‚Äì ${row.idopont}`
        )
      ) {
        return;
      }

      const body =
        "action=delete" +
        "&nev=" +
        encodeURIComponent(row.nev) +
        "&idopont=" +
        encodeURIComponent(row.idopont);

      fetch(SCRIPT_URL, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: body,
      })
        .then(() => {
          alert("T√∂r√∂lve ‚úÖ");
          loadData();
        })
        .catch((err) => {
          console.error("delete error:", err);
          alert("Hiba t√∂rt√©nt t√∂rl√©s k√∂zben.");
        });
    }

    window.onload = loadData;
  </script>
</body>
</html>
