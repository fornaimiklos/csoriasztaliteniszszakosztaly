<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Edzés Jelentkezés</title>
  <style>
    body{
      margin:0;padding:20px;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      background:#f0f2f5;
      display:flex;justify-content:center;align-items:flex-start;
    }
    .box{
      width:420px;max-width:95%;
      background:#fff;border-radius:18px;
      padding:22px;
      box-shadow:0 10px 30px rgba(0,0,0,.1);
    }
    h1{margin:0;font-size:32px;}
    .sub{color:#666;margin-bottom:16px;}
    label{display:block;margin:14px 0 6px;font-weight:700;}
    input,select{
      width:100%;padding:14px;font-size:16px;
      border-radius:12px;border:1px solid #ddd;
    }
    button{
      width:100%;padding:16px;font-size:18px;
      border-radius:14px;border:none;
      cursor:pointer;margin-top:12px;
      color:#fff;font-weight:800;
    }
    .btn1{background:linear-gradient(90deg,#ff4d6d,#ff7a00);}
    .btn2{background:#6b7280;}
    .msg{margin-top:12px;font-weight:700}
    .err{color:#dc2626}
    .ok{color:#16a34a}
    .warn{color:#b45309}
    ul{margin-left:20px}
  </style>
</head>
<body>

<div class="box">
  <h1>Edzés Jelentkezés</h1>
  <div class="sub">(Tagoknak NEM kell regisztrálni)</div>

  <label>Név</label>
  <input id="name" placeholder="Pl. Csóri Pingpongos">

  <label>Időpont</label>
  <select id="dates">
    <option value="">-- Válassz időpontot --</option>
  </select>

  <div id="note" style="margin-top:8px;color:#666"></div>

  <button class="btn1" onclick="signup()">Jelentkezem</button>
  <button class="btn2" onclick="del()">Jelentkezésem törlése</button>

  <div id="msg" class="msg"></div>

  <h2 style="margin-top:24px">Jelentkezők</h2>
  <div id="list"></div>
</div>

<script>
const API =
"https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLj2cvPDf_DlbdPPns07mP-eNZOrcMEaCZ3k25OMVJbAkBzWySa-TQuosv0N4b9va3pwDU99wPj2BO-AxYRkih6ZbhxaXAdGjCjr-G4ITS";

let DATA = {trainings:[], signups:[]};

async function api(params){
  const url = API + "&" + new URLSearchParams(params);
  const r = await fetch(url);
  return await r.json();
}

async function load(){
  const d = await api({action:"getData"});
  DATA = d;
  renderDates();
  renderList();
}

function renderDates(){
  const s = document.getElementById("dates");
  s.innerHTML = '<option value="">-- Válassz időpontot --</option>';
  DATA.trainings.slice(0,5).forEach(t=>{
    const o = document.createElement("option");
    o.value = t.dateText;
    o.textContent = t.dateText;
    o.dataset.note = t.noteText||"";
    s.appendChild(o);
  });
}

document.getElementById("dates").onchange = e=>{
  document.getElementById("note").textContent =
    e.target.selectedOptions[0]?.dataset.note || "";
};

async function signup(){
  const name = document.getElementById("name").value.trim();
  const date = document.getElementById("dates").value;
  if(!name||!date) return msg("Hiányzó adat","err");

  const note = document.getElementById("dates")
    .selectedOptions[0].dataset.note||"";

  const r = await api({action:"signup",name,dateText:date,noteText:note});
  if(!r.ok) return msg(r.error,"err");
  msg("Sikeres jelentkezés","ok");
  load();
}

async function del(){
  const name = document.getElementById("name").value.trim();
  if(!name) return msg("Add meg a neved","err");
  const date = document.getElementById("dates").value;
  const r = await api({action:"delete",name,dateText:date});
  if(!r.ok) return msg(r.error,"err");
  msg("Törölve","ok");
  load();
}

function renderList(){
  const d = document.getElementById("list");
  d.innerHTML="";
  const map={};
  DATA.signups.forEach(s=>{
    map[s.dateText]=map[s.dateText]||[];
    map[s.dateText].push(s.name);
  });
  Object.keys(map).forEach(k=>{
    d.innerHTML += `<b>${k}</b><ul>` +
      map[k].map(n=>`<li>${n}</li>`).join("") +
      "</ul>";
  });
}

function msg(t,c){
  const m=document.getElementById("msg");
  m.textContent=t;
  m.className="msg "+c;
}

load();
</script>
</body>
</html>
