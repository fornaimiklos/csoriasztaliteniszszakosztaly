<div class="card">
    <h2>üèì Edz√©s Jelentkez√©s</h2>
    <input type="text" id="userName" placeholder="Neved..." required>
    
    <select id="dateSelect" onchange="showParticipants()">
        <option value="">-- V√°lassz id≈ëpontot --</option>
    </select>

    <div id="participantList" style="margin-top: 15px; font-size: 14px; color: #444; text-align: left; background: #f9f9f9; padding: 10px; border-radius: 8px; display: none;">
        <strong>Eddigi jelentkez≈ëk:</strong>
        <div id="names"></div>
    </div>

    <button onclick="submitForm()" id="submitBtn" style="margin-top:20px;">OTT LESZEK!</button>
    <p id="msg"></p>
</div>

<script>
    const scriptURL = function showParticipants() {
    const selectedDate = document.getElementById('dateSelect').value.trim();
    const listDiv = document.getElementById('participantList');
    const namesDiv = document.getElementById('names');
    
    if(!selectedDate) { 
        listDiv.style.display = 'none'; 
        return; 
    }

    // Itt t√∂rt√©nik az √∂sszehasonl√≠t√°s: lev√°gjuk az esetleges sz√≥k√∂z√∂ket mindk√©t oldalon
    const filtered = allParticipants
        .filter(p => p.idopont.trim() === selectedDate)
        .map(p => p.nev);

    if(filtered.length > 0) {
        namesDiv.innerHTML = "<strong>" + filtered.join(", ") + "</strong>";
    } else {
        namesDiv.innerHTML = "<em>M√©g nincs jelentkez≈ë erre a napra.</em>";
    }
    listDiv.style.display = 'block';
}
    let allParticipants = [];

    // 1. Bet√∂ltj√ºk az adatokat a Google T√°bl√°zatb√≥l
    async function loadParticipants() {
        try {
            const response = await fetch(scriptURL);
            allParticipants = await response.json();
            setDates(); // Csak ha megvannak az adatok, gener√°lunk d√°tumokat
        } catch (e) { console.log("Hiba az adatok let√∂lt√©sekor"); setDates(); }
    }

    // 2. D√°tumv√°laszt√≥ gener√°l√°sa (mint kor√°bban)
    function setDates() {
        const select = document.getElementById('dateSelect');
        let today = new Date();
        for (let i = 1; i <= 7; i++) {
            let d = new Date(); d.setDate(today.getDate() + i);
            let day = d.getDay();
            if (day === 2 || day === 4 || day === 0) {
                let opt = document.createElement('option');
                let label = d.toLocaleDateString('hu-HU', {month:'short', day:'numeric', weekday:'short'});
                let time = (day === 0) ? "9:00 - 12:00" : "19:00 - 21:00";
                opt.value = label + " | " + time;
                opt.text = label + " | " + time;
                select.add(opt);
            }
        }
    }

    // 3. Ez a f√ºggv√©ny sz≈±ri ki a neveket az adott napra
    function showParticipants() {
        const selectedDate = document.getElementById('dateSelect').value;
        const listDiv = document.getElementById('participantList');
        const namesDiv = document.getElementById('names');
        
        if(!selectedDate) { listDiv.style.display = 'none'; return; }

        const filtered = allParticipants
            .filter(p => p.idopont === selectedDate)
            .map(p => p.nev);

        if(filtered.length > 0) {
            namesDiv.innerHTML = filtered.join(", ");
        } else {
            namesDiv.innerHTML = "M√©g nincs jelentkez≈ë.";
        }
        listDiv.style.display = 'block';
    }

    function submitForm() {
        const name = document.getElementById('userName').value;
        const date = document.getElementById('dateSelect').value;
        if(!name || !date) { alert("N√©v √©s d√°tum k√∂telez≈ë!"); return; }

        document.getElementById('submitBtn').disabled = true;
        fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify({n√©v: name, id≈ëpont: date})
        }).then(() => {
            alert("Sikeresen jelentkezt√©l!");
            location.reload(); // Friss√≠tj√ºk az oldalt, hogy l√°tsz√≥djon az √∫j n√©v is
        });
    }

    loadParticipants(); // Ind√≠t√°skor bet√∂lt√©s
</script>
